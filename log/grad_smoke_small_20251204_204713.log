2025-12-04 20:47:16,089 - INFO - Args: {'scenario': 'grad', 'seed': 0, 'batch_size_images': 8, 'event_batch_size': 2048, 'run_name': 'smoke_small_20251204_204713_grad', 'log_interval': 1, 'num_epochs': 1, 'T_unsup1': 50, 'T_unsup2': 50, 'T_semi': 50, 'T_sup': 50, 'spike_array_len': 10, 'sigma_unsup1': 0.1, 'sigma_unsup2': 0.1, 'sigma_semi': 0.1, 'sigma_sup': 0.1, 'N_E': 32, 'N_hidden': 64, 'dt': 1.0, 'layer_index_scale': 1.0, 'lr_actor': 0.001, 'lr_critic': 0.001, 'ppo_eps': 0.2, 'ppo_epochs': 2, 'ppo_batch_size': 8, 'exc_clip_min': 0.0, 'exc_clip_max': 1.0, 'inh_clip_min': 0.0, 'inh_clip_max': 1.0, 'local_lr': 0.01, 'rho_target': 0.1, 'alpha_sparse': 1.0, 'alpha_div': 0.1, 'alpha_stab': 0.1, 'beta_margin': 0.5, 'alpha_align': 0.1, 'max_rate': 0.1, 'log_gradient_stats': True, 'result_dir': 'results/grad/smoke_small_20251204_204713_grad'}
2025-12-04 20:47:16,090 - INFO - Starting scenario: grad
2025-12-04 20:47:16,090 - INFO - Results will be saved to: results/grad/smoke_small_20251204_204713_grad
Traceback (most recent call last):
  File "/home/yongokhan/바탕화면/RL_SNN/main.py", line 39, in <module>
    main()
  File "/home/yongokhan/바탕화면/RL_SNN/main.py", line 35, in main
    runner(args, logger)
  File "/home/yongokhan/바탕화면/RL_SNN/scenarios/grad_mimicry.py", line 234, in run_grad
    per_sample_grads = vmap(grad_fn, in_dims=(None, 0, 0))(teacher_params, input_spikes, labels)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/apis.py", line 203, in wrapped
    return vmap_impl(
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/vmap.py", line 331, in vmap_impl
    return _flat_vmap(
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/vmap.py", line 479, in _flat_vmap
    batched_outputs = func(*batched_inputs, **kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/apis.py", line 399, in wrapper
    return eager_transforms.grad_impl(func, argnums, has_aux, args, kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/eager_transforms.py", line 1406, in grad_impl
    results = grad_and_value_impl(func, argnums, has_aux, args, kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/vmap.py", line 48, in fn
    return f(*args, **kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/eager_transforms.py", line 1364, in grad_and_value_impl
    output = func(*args, **kwargs)
  File "/home/yongokhan/바탕화면/RL_SNN/scenarios/grad_mimicry.py", line 229, in loss_fn
    _, _, firing_teacher = functional_call(teacher, params_dict, (spikes.unsqueeze(0),))
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/_functorch/functional_call.py", line 148, in functional_call
    return nn.utils.stateless._functional_call(
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/nn/utils/stateless.py", line 300, in _functional_call
    return module(*args, **kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/yongokhan/miniconda3/envs/snn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yongokhan/바탕화면/RL_SNN/snn/network_grad_mimicry.py", line 75, in forward
    hidden_spikes[0][:, :, t] = s_hidden
RuntimeError: vmap: inplace arithmetic(self, *extra_args) is not possible because there exists a Tensor `other` in extra_args that has more elements than `self`. This happened due to `other` being vmapped over but `self` not being vmapped over in a vmap. Please try to use out-of-place operators instead of inplace arithmetic. If said operator is being called inside the PyTorch framework, please file a bug report instead.
